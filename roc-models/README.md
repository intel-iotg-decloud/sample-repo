# ROC files for existing RIs

The origin code for each model folder is:
* metadata.yaml
* VERSION
* yang folder
  * and all YANG files beneath

All other files in the model folders are autogenerated using the 2 commands below:


# Helm Install rocaas-prereqs
The following assumes that you have added the one-intel-edge repo as `one-intel-edge`

```shell
helm repo add --force-update --pass-credentials --username <your id> one-intel-edge https://amr-registry.caas.intel.com/chartrepo/one-intel-edge/
```
> is there is an OpenShift equivalent helm repo it can be used


```shell
helm -n kube-system install rocaas-prereqs one-intel-edge/rocaas-prereqs
```

# Smart Retail Analytics
For `sra-0.2x` model example to generate file is (run from `$HOME/git/intel-iotg-decloud/sample-repo`):

```shell
docker run -v $HOME/git/intel-iotg-decloud/sample-repo/roc-models/sra-0.2.x:/config-model onosproject/model-compiler:v0.10.48
```

```shell
docker run \
-v $HOME/git/intel-iotg-decloud/sample-repo/roc-models:/models \
-v $HOME/git/intel-iotg-decloud/sample-repo/roc-models/sra-0.2.x/out:/tmp/out \
-w /models \
--env DOCKER_REGISTRY=default-route-openshift-image-registry.apps.nex.one-edge.intel.com \
--env DOCKER_REPOSITORY_BASE=springboard-dev-common/ \
--entrypoint="/usr/local/bin/generate-code.sh" \
default-route-openshift-image-registry.apps.nex.one-edge.intel.com/springboard-dev-common/roc-cli:0.0.7 \
-m sra -r 0.2.x -j -o -d
```

## Build
Then build by running
```shell
roc-models/sra-0.2.x/deployment/docker_build_cmds.sh
```

## Deployment
> The following assumes that you have added the one-intel-edge repo as `one-intel-edge` (see [Helm Install rocaas-prereqs] above)

Deploy with:
```shell
kubectl create namespace sra-roc
helm -n sra-roc install roc-sra one-intel-edge/rocaas-umbrella \
-f $HOME/git/intel-iotg-decloud/sample-repo/roc-models/sra-0.2.x/deployment/values.yaml \
--set-file config.megaPatch=~/git/intel-iotg-decloud/sample-repo/roc-models/sra-0.2.x/examples/mega-ri.json
```

# Smart City Analytics
For `sca-0.1.x` model example to generate file is (run from `$HOME/git/intel-iotg-decloud/sample-repo`):

```shell
docker run -v $HOME/git/intel-iotg-decloud/sample-repo/roc-models/sca-0.1.x:/config-model onosproject/model-compiler:v0.10.48
```

```shell
docker run \
-v $HOME/git/intel-iotg-decloud/sample-repo/roc-models:/models \
-v $HOME/git/intel-iotg-decloud/sample-repo/roc-models/sca-0.1.x/out:/tmp/out \
-w /models \
--env DOCKER_REGISTRY=default-route-openshift-image-registry.apps.nex.one-edge.intel.com \
--env DOCKER_REPOSITORY_BASE=springboard-dev-common/ \
--env TARGET_KIND=city \
--env SAMPLE_TARGET=reference-city \
--env SAMPLE_TARGET_NAME="Reference City" \
--entrypoint="/usr/local/bin/generate-code.sh" \
default-route-openshift-image-registry.apps.nex.one-edge.intel.com/springboard-dev-common/roc-cli:0.0.7 \
-m sca -r 0.1.x -j -o -d
```

## Build
Then build by running
```shell
roc-models/sca-0.1.x/deployment/docker_build_cmds.sh
```

## Deployment

Deploy SCA with:
```shell
kubectl create namespace sca-roc
helm -n sca-roc install roc-sca one-intel-edge/rocaas-umbrella \
-f ~/git/intel-iotg-decloud/sample-repo/roc-models/sca-0.1.x/deployment/values.yaml \
--set-file config.megaPatch=$HOME/git/intel-iotg-decloud/sample-repo/roc-models/sca-0.1.x/examples/mega-ri.json \
--set roc-gui.service.nodePort=30003
```

> Here we set the ROC GUI port to 30003 - only needed if deploying at the same time as SRA, to avoid clashing node ports. 


> Adjust accordingly for your checked out folder and the RI model you are generating.

See https://github.com/intel-innersource/frameworks.edge.one-intel-edge.maestro-app.roc.rocaas-tools/blob/main/rocaas-cli/build/README.md for more details

## Pushing to alternative registries
The `./roc-models/docker_tag_models.sh` can be used to tag and push to alternate Docker registries

> Example:
> 
> `./roc-models/docker_tag_models.sh -g amr-registry.caas.intel.com/one-intel-edge/ -r roc/`